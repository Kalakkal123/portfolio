<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CSS 3D Terrain Generator (no WebGL)</title>
  <style>
    :root{
      --cols: 48;
      --rows: 32;
      --tile-size: 14px;
      --block-depth: 14px;
      --layer-spacing: 6;
      --max-height: 40;
      --scene-rotate-x: 55deg;
      --scene-rotate-y: -10deg;
    }

    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
    body{display:flex;gap:20px;padding:18px;background:linear-gradient(180deg,#0f172a,#071028);color:#eef;text-align:center}

    .panel{width:360px;min-width:260px;background:rgba(255,255,255,0.03);padding:14px;border-radius:12px;box-shadow:0 6px 30px rgba(0,0,0,0.6)}
    .panel h2{margin:6px 0 12px;font-size:18px}
    .row{display:flex;gap:8px;margin:8px 0;align-items:center}
    label{font-size:13px;min-width:78px;text-align:left;color:#cfe}
    input[type=range]{flex:1}
    input[type=number], input[type=text]{width:100%;padding:6px;border-radius:6px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    button{margin-top:8px;padding:8px 10px;border-radius:8px;border:0;background:#1f2937;color:#fff;cursor:pointer}

    .stage{flex:1;display:flex;align-items:center;justify-content:center}
    .viewport{
      width:calc(var(--cols) * var(--tile-size));
      height:calc(var(--rows) * var(--tile-size));
      perspective:1000px;
      perspective-origin:50% 20%;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2));
      border-radius:12px; padding:14px;box-sizing:content-box;
    }

    .scene{
      width:100%;height:100%;transform-style:preserve-3d;transform:rotateX(var(--scene-rotate-x)) rotateY(var(--scene-rotate-y));
      position:relative; margin:auto;
    }

    .block{
      position:absolute;
      width:var(--tile-size);
      height:var(--tile-size);
      transform-style:preserve-3d;
    }

    .face{
      position:absolute;
      width:100%;
      height:100%;
      background:linear-gradient(180deg,#3a3,#282);
      backface-visibility:hidden;
      border:1px solid rgba(0,0,0,0.05);
    }

    .top{transform:rotateX(90deg) translateZ(calc(var(--block-depth)/2));}
    .bottom{transform:rotateX(-90deg) translateZ(calc(var(--block-depth)/2));}
    .front{transform:translateZ(calc(var(--block-depth)/2));}
    .back{transform:rotateY(180deg) translateZ(calc(var(--block-depth)/2));}
    .left{transform:rotateY(-90deg) translateZ(calc(var(--block-depth)/2));}
    .right{transform:rotateY(90deg) translateZ(calc(var(--block-depth)/2));}
  </style>
</head>
<body>
  <div class="panel">
    <h2>CSS 3D Terrain Generator</h2>
    <div class="row"><label>Seed</label><input id="seed" type="text" value="12345"></div>
    <div class="row"><label>Scale</label><input id="scale" type="range" min="4" max="120" value="24"><div style="width:48px;text-align:right" id="scaleVal">24</div></div>
    <div class="row"><label>Octaves</label><input id="octaves" type="range" min="1" max="6" value="4"><div style="width:28px;text-align:right" id="octVal">4</div></div>
    <div class="row"><label>Persistence</label><input id="persistence" type="range" min="0.1" max="1" step="0.05" value="0.5"><div style="width:36px;text-align:right" id="persVal">0.5</div></div>
    <div class="row"><label>Max height</label><input id="maxh" type="range" min="6" max="80" value="36"><div style="width:36px;text-align:right" id="maxhVal">36</div></div>
    <div style="display:flex;gap:8px">
      <button id="regen">Regenerate</button>
      <button id="randomize">Random seed</button>
    </div>
  </div>
  <div class="stage">
    <div class="viewport">
      <div id="scene" class="scene"></div>
    </div>
  </div>

  <script>
    function mulberry32(a){return function(){var t=a+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296;}}
    function fade(t){return t*t*(3-2*t);} function lerp(a,b,t){return a+(b-a)*t;}
    function makeValueGrid(seed,gx,gy){const rnd=mulberry32(hashString(seed));const grid=new Float32Array((gx+1)*(gy+1));for(let j=0;j<=gy;j++)for(let i=0;i<=gx;i++)grid[j*(gx+1)+i]=rnd();return{grid,gx,gy};}
    function sampleValueGrid(g,x,y){const gx=g.gx,gy=g.gy,grid=g.grid;if(x<0)x=0;if(y<0)y=0;if(x>gx-1)x=gx-1;if(y>gy-1)y=gy-1;const xi=Math.floor(x),yi=Math.floor(y);const xf=x-xi,yf=y-yi;const a=grid[yi*(gx+1)+xi];const b=grid[yi*(gx+1)+(xi+1)];const c=grid[(yi+1)*(gx+1)+xi];const d=grid[(yi+1)*(gx+1)+(xi+1)];const u=fade(xf),v=fade(yf);return lerp(lerp(a,b,u),lerp(c,d,u),v);}  
    function fbm(nx,ny,octaves,persistence,seed){let value=0,amplitude=1,frequency=1,max=0;for(let o=0;o<octaves;o++){const gx=Math.ceil((nx*frequency)+1);const gy=Math.ceil((ny*frequency)+1);const grid=makeValueGrid(seed+'|'+o,gx,gy);value+=sampleValueGrid(grid,nx*frequency,ny*frequency)*amplitude;max+=amplitude;amplitude*=persistence;frequency*=2;}return value/max;}
    function hashString(s){let h=2166136261>>>0;for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h=Math.imul(h,16777619);}return h>>>0;}

    const scene=document.getElementById('scene');

    function createBlock(x,y,z,color){
      const block=document.createElement('div');
      block.className='block';
      block.style.transform=`translate3d(${x}px,${y}px,${z}px)`;
      const faces=['front','back','left','right','top','bottom'];
      for(const f of faces){const face=document.createElement('div');face.className='face '+f;face.style.background=color;block.appendChild(face);}return block;
    }

    function colorForHeight(h){
      if(h<0.35)return '#1a6ccf'; // water
      if(h<0.42)return '#e6d5b3'; // sand
      if(h<0.7)return '#2a8f3b'; // grass
      if(h<0.88)return '#7a7370'; // rock
      return '#fff'; // snow
    }

    function generate(){
      const seed=document.getElementById('seed').value||Date.now().toString();
      const scale=Number(document.getElementById('scale').value);
      const oct=Number(document.getElementById('octaves').value);
      const pers=Number(document.getElementById('persistence').value);
      const maxh=Number(document.getElementById('maxh').value);
      const cols=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--cols'));
      const rows=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--rows'));
      const tile=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--tile-size'));
      const depth=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--block-depth'));
      scene.innerHTML='';
      for(let y=0;y<rows;y++){
        for(let x=0;x<cols;x++){
          const nx=x/scale,ny=y/scale;
          const h=fbm(nx,ny,oct,pers,seed);
          const height=Math.floor(h*maxh/10);
          const color=colorForHeight(h);
          for(let z=0;z<=height;z++){
            const px=x*tile;const py=y*tile;const pz=z*depth;
            const block=createBlock(px,py,pz,color);
            scene.appendChild(block);
          }
        }
      }
    }

    document.getElementById('regen').onclick=generate;
    document.getElementById('randomize').onclick=()=>{document.getElementById('seed').value=Math.floor(Math.random()*1e9).toString();generate();};

    (function addDrag(){let dragging=false,ox=0,oy=0;const root=document.documentElement;document.querySelector('.viewport').addEventListener('pointerdown',e=>{dragging=true;ox=e.clientX;oy=e.clientY;});window.addEventListener('pointerup',()=>dragging=false);window.addEventListener('pointermove',e=>{if(!dragging)return;const dx=e.clientX-ox,dy=e.clientY-oy;ox=e.clientX;oy=e.clientY;const rx=parseFloat(getComputedStyle(root).getPropertyValue('--scene-rotate-x'))||55;const ry=parseFloat(getComputedStyle(root).getPropertyValue('--scene-rotate-y'))||-10;root.style.setProperty('--scene-rotate-x',(rx-dy*0.15)+'deg');root.style.setProperty('--scene-rotate-y',(ry+dx*0.15)+'deg');});})();

    generate();
  </script>
</body>
</html>
